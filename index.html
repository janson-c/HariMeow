<script>
  // Select the df-messenger element
  const dfMessenger = document.querySelector('df-messenger');

  if (dfMessenger) {
    console.log('[DEBUG] "catch" script is loaded and dfMessenger is found.');

    // Add an event listener to check every response from the bot
    dfMessenger.addEventListener('df-response-received', function (event) {
      
      console.log('[DEBUG] df-response-received event was fired!');
      console.log('[DEBUG] Full response data:', event.detail.response);

      const queryResult = event.detail.response.queryResult;
      
      // Check if responseMessages exists
      if (queryResult && queryResult.responseMessages) {
        
        console.log('[DEBUG] Checking for payloads...');
        const messages = queryResult.responseMessages;

        const payloadMsg = messages.find(m => m.payload);
        
        if (payloadMsg) {
          console.log('[DEBUG] Payload was found in the response!', payloadMsg.payload);
          
          const payload = payloadMsg.payload.fields;
          
          if (payload && payload.command && payload.command.stringValue === 'setLanguage') {
            const newLang = payload.lang.stringValue;
            
            console.log('Language switch signal received. Setting lang to:', newLang);
            dfMessenger.lang = newLang;
            
          } else {
            console.log('[DEBUG] Payload found, but it was not the setLanguage command.');
          }
        } else {
          console.log('[DEBUG] No payload was found in this response.');
        }
      } else {
        console.log('[DEBUG] No responseMessages found in this response.');
      }
    });
  } else {
    console.error('[DEBUG] FAILED to find df-messenger element!');
  }
</script>
